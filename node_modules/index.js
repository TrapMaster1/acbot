// bot.js



const Twit = require('twit');
const axios = require('axios');
const split = require('split-string');
const cheerio = require('cheerio');
const rp = require('request-promise');

var date = new Date();


const TH = new Twit({
    consumer_key: process.env.TWITTER_API_CONSUMER,
    consumer_secret: process.env.TWITTER_API_CONSUMER_SECRET,
    access_token: process.env.TWITTER_API_ACCESS,
    access_token_secret: process.env.TWITTER_API_ACCESS_SECRET,
});

const months = ["January", "February", "March", "April", "May", "June",
"July", "August", "September", "October", "November", "December"
];

const _self = {
    id: 1045101008433664005,
    screen_name: 'Bot Boi'
};

results = "";
name = "";
day = "";
tweet = "";


function tweet_day() {
    TH.post('statuses/update', {status: tweet}, function(err, data, response) {
        console.log(data)
    })
    return
}

function getBirthdays () {
    const month = date.getMonth() + 1;
    const day = date.getDate() - 1;

    axios.get('http://animalcrossing.wikia.com/api/v1/Articles/AsSimpleJson?id=83416')
    .then(res => {
        results = res.data.sections[month].content[0].elements[day].text;
        console.log(results)
        // processResults()
        tweet_day();
    })
}

function processResults () {  
    result_arr = split(results, {separator: '-' });
    name = result_arr[1];
    day = result_arr[0];

    tweet = "Today's birthday is" + name + "'s! Happy " + day + "!";
    console.log(tweet);
    rp('http://tomatoland.org/dada/acnl/scripts/villager-list.php')

    .then( function(html) {
        // const $ = cheerio.load(html);
        // console.log($('table > tbody > tr > td', '.name').text());
        console.log($('.i').text());

    })
}

getBirthdays();


return;
